<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masterclass Student Guide | Cosmic Explorer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@300;500;700&display=swap"
        rel="stylesheet">
    <style>
        .guide-content {
            line-height: 1.8;
            font-size: 1.1rem;
            color: var(--text-white);
        }

        .guide-content h2 {
            color: var(--secondary);
            margin-top: 3.5rem;
            font-family: 'Outfit', sans-serif;
            font-size: 2.2rem;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }

        .guide-content h3 {
            color: var(--secondary);
            margin-top: 2.5rem;
            font-family: 'Outfit', sans-serif;
            font-size: 1.5rem;
        }

        .guide-content p {
            margin-bottom: 1.5rem;
        }

        .guide-content strong {
            color: var(--secondary);
        }

        .guide-content blockquote {
            border-left: 4px solid var(--secondary);
            padding-left: 1.5rem;
            margin: 2rem 0;
            font-style: italic;
            background: rgba(255, 145, 0, 0.05);
            padding-top: 1rem;
            padding-bottom: 1rem;
            border-radius: 0 16px 16px 0;
        }

        /* 3D Visual Containers */
        .visual-block-wrapper {
            margin: 3rem 0;
            scroll-margin-top: 100px;
        }

        .visual-block {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            min-height: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .visual-iframe {
            width: 100%;
            height: 500px;
            border: none;
            display: block;
        }

        .visual-caption {
            padding: 1.2rem;
            background: rgba(13, 17, 23, 0.9);
            font-size: 0.9rem;
            color: var(--secondary);
            text-align: center;
            border-top: 1px solid var(--glass-border);
            font-weight: 500;
        }

        .visual-significance {
            padding: 1.5rem;
            background: rgba(0, 210, 255, 0.05);
            border-left: 4px solid var(--secondary);
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-white);
            margin-top: -1px;
            border-radius: 0 0 20px 20px;
            border: 1px solid var(--glass-border);
            border-top: none;
        }

        /* Reactive Glossary Styles */
        .reactive-term {
            color: var(--secondary);
            font-weight: 600;
            border-bottom: 1px dashed var(--secondary);
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            padding: 0 2px;
        }

        .reactive-term:hover {
            background: rgba(0, 210, 255, 0.15);
            border-bottom-style: solid;
            border-radius: 4px;
        }

        .tooltip-bubble {
            visibility: hidden;
            width: 240px;
            background-color: #1a1a2e;
            color: #fff;
            text-align: center;
            border-radius: 12px;
            padding: 15px;
            position: absolute;
            z-index: 1000;
            bottom: 140%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid var(--secondary);
            font-size: 0.85rem;
            line-height: 1.5;
            pointer-events: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .reactive-term:hover .tooltip-bubble {
            visibility: visible;
            opacity: 1;
            bottom: 125%;
        }

        .highlight-flash {
            animation: pulse-glow 2s ease;
        }

        @keyframes pulse-glow {
            0% {
                border-color: var(--glass-border);
                box-shadow: none;
            }

            50% {
                border-color: var(--secondary);
                box-shadow: 0 0 30px rgba(255, 145, 0, 0.4);
            }

            100% {
                border-color: var(--glass-border);
                box-shadow: none;
            }
        }

        .back-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .anga-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .anga-icon {
            font-size: 2rem;
            background: rgba(255, 145, 0, 0.1);
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            color: var(--secondary);
            flex-shrink: 0;
        }

        .anga-info h4 {
            color: var(--secondary);
            margin-bottom: 0.3rem;
            font-size: 1.1rem;
        }

        .anga-info p {
            margin-bottom: 0;
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        /* Cosmic Chatbot Styles */
        #chat-widget-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        #chat-window {
            width: 350px;
            height: 450px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid var(--secondary);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(20px);
            opacity: 0;
            pointer-events: none;
        }

        #chat-window.active {
            transform: translateY(0);
            opacity: 1;
            pointer-events: all;
        }

        .chat-header {
            padding: 1rem;
            background: linear-gradient(to right, rgba(255, 145, 0, 0.2), rgba(255, 111, 0, 0.1));
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h4 {
            margin: 0;
            font-size: 1rem;
            color: var(--secondary);
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 85%;
            padding: 0.8rem 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .message.bot {
            background: rgba(255, 255, 255, 0.05);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        .message.user {
            background: var(--secondary);
            color: #000;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
            font-weight: 500;
        }

        .chat-input-area {
            padding: 1rem;
            border-top: 1px solid var(--glass-border);
            display: flex;
            gap: 0.5rem;
        }

        #chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 0.5rem 0.8rem;
            color: white;
            font-size: 0.9rem;
        }

        #chat-input:focus {
            outline: none;
            border-color: var(--secondary);
        }

        #chat-toggle-btn {
            width: 60px;
            height: 60px;
            background: var(--secondary);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 145, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: transform 0.3s;
        }

        #chat-toggle-btn:hover {
            transform: scale(1.1);
        }

        .dots {
            display: inline-block;
        }

        .dots::after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {

            0%,
            20% {
                content: '.';
            }

            40% {
                content: '..';
            }

            60% {
                content: '...';
            }

            80%,
            100% {
                content: '';
            }
        }
    </style>
</head>

<body>
    <div class="container" style="max-width: 900px;">
        <header>
            <h1>Cosmic Masterclass</h1>
            <p>The Advanced Student's Guide to Time & Space</p>
        </header>

        <main>
            <div class="back-nav">
                <a href="/" class="insight-link" style="background: rgba(255,255,255,0.05);">‚Üê Return to Converter</a>
                <button id="audio-tutor-btn" class="btn glass"
                    style="background: rgba(0, 210, 255, 0.1); border: 1px solid var(--secondary); color: var(--secondary); padding: 0.6rem 1.2rem; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-family: 'Outfit', sans-serif; font-weight: 600; font-size: 0.9rem;">
                    <span id="audio-icon">üéôÔ∏è</span> <span id="audio-text">Listen to Maestro</span>
                </button>
            </div>

            <section class="card glass guide-content">
                <h2>1. The Two Clocks of Earth</h2>
                <p>
                    Every culture has a "Map of Time." To build one, you need a clock that never stops.
                </p>
                <p>
                    <strong>The Western Calendar (Solar)</strong>: Imagine Earth's journey around the Sun as a circular
                    race track. The Western calendar is tuned to the <strong>Seasons</strong>. It measures the ~365.24
                    days it takes to return to the Spring Equinox. To stay centered with the Sun, we add a "Leap Day"
                    every 4 years.
                </p>
                <p>
                    <strong>The Hindu Panchanga (Luni-Solar-Sidereal)</strong>: The Panchanga is more like a
                    multi-dimensional dashboard. It doesn't just look at the Sun; it tracks the Sun, the Moon, and the
                    **Fixed Stars** simultaneously. While the Western clock tells you the "Season," the Panchanga tells
                    you the "Position" in the galaxy.
                </p>

                <h2>2. The 5 Limbs (Angas) of Time</h2>
                <p>
                    "Panchanga" literally means "Five Limbs." These five elements are the DNA of any specific moment.
                </p>

                <div class="anga-card">
                    <div class="anga-icon">üìÖ</div>
                    <div class="anga-info">
                        <h4>Vara (Weekday)</h4>
                        <p>The solar day, ruled by the 7 major planets visible to the naked eye.</p>
                    </div>
                </div>

                <div class="anga-card">
                    <div class="anga-icon">üåô</div>
                    <div class="anga-info">
                        <h4>Tithi (Lunar Day)</h4>
                        <p>Based on the geometric angle between Sun and Moon. Not a 24-hour clock!</p>
                    </div>
                </div>

                <div class="anga-card" onclick="triggerVisualHighlight('CONSTELLATION_MAP')" style="cursor: pointer;">
                    <div class="anga-icon">‚≠ê</div>
                    <div class="anga-info">
                        <h4>Nakshatra (Star Mansion)</h4>
                        <p>The specific star cluster the Moon is visiting. High-resolution time tracking.</p>
                    </div>
                </div>

                <div class="anga-card">
                    <div class="anga-icon">üîÑ</div>
                    <div class="anga-info">
                        <h4>Yoga (Addition)</h4>
                        <p>Mathematical sum of Sun and Moon's longitudes. Represents the "mood" of the day.</p>
                    </div>
                </div>

                <div class="anga-card">
                    <div class="anga-icon">‚úÇÔ∏è</div>
                    <div class="anga-info">
                        <h4>Karana (Half-Tithi)</h4>
                        <p>The active interval. There are 2 Karanas in every Tithi.</p>
                    </div>
                </div>

                <div class="visual-block-wrapper" id="CONSTELLATION_MAP">
                    <div class="visual-block">
                        <iframe class="visual-iframe" src="/visuals/constellations"></iframe>
                        <div class="visual-caption">üñ•Ô∏è Sky Focus: The 27 Nakshatra Grid</div>
                    </div>
                    <div class="visual-significance">
                        <strong>Significance:</strong> While the Western calendar uses 12 Zodiac signs, the Hindu system
                        sub-divides the sky into **27 Nakshatras**. This allows us to track the Moon's movement with
                        incredible precision‚Äîone Nakshatra per day.
                    </div>
                </div>

                <h2>3. The Cosmic Stadium (Zodiac)</h2>
                <p>
                    The planets don't just wander anywhere. They all stick to a specific path called the **Ecliptic**.
                    Ancient astronomers divided this path into 12 zones called the **Zodiac**.
                </p>
                <blockquote>
                    "Imagine a stadium where the players (planets) run around the field, and the Zodiac signs are the
                    giant advertisements on the stadium walls in the distance."
                </blockquote>

                <div class="visual-block-wrapper" id="ZODIAC_STADIUM">
                    <div class="visual-block">
                        <iframe class="visual-iframe" src="/visuals/zodiac"></iframe>
                        <div class="visual-caption">üñ•Ô∏è 3D Zodiac Stadium Perspective</div>
                    </div>
                    <div class="visual-significance">
                        <strong>Significance:</strong> From Earth's perspective, we say "Sun is in Aries" because Aries
                        is the billboard behind the Sun at that moment. Toggle the view to see how the Rashi names like
                        Mesha correspond to Western Aries.
                    </div>
                </div>

                <h2>4. The Great Wobble (Precession)</h2>
                <p>
                    Here is the mind-blowing part: **The North Star isn't permanent.**
                </p>
                <p>
                    Earth is like a spinning top that is beginning to tilt. This is <span class="reactive-term"
                        onclick="triggerVisualHighlight('PRECESSION_WOBBLE')">Precession<span class="tooltip-bubble">The
                            slow conical wobble of Earth's axis (25,800 year cycle). <br><i>(Click to see 3D
                                visual)</i></span></span>. It takes 25,800 years for the Earth's axis to draw one slow
                    circle in the sky.
                </p>

                <div class="visual-block-wrapper" id="PRECESSION_WOBBLE">
                    <div class="visual-block">
                        <iframe class="visual-iframe" src="/visuals/precession"></iframe>
                        <div class="visual-caption">üñ•Ô∏è The Earth's Axial Wobble (25,800 yr Cycle)</div>
                    </div>
                    <div class="visual-significance">
                        <strong>Significance:</strong> Right now, the axis points to **Polaris**. In the time of Ancient
                        Egypt, it pointed to **Thuban**. In 12,000 years, **Vega** will be our North Star. This wobble
                        causes a drift between the seasons and the stars.
                    </div>
                </div>

                <h3>Tropical vs Sidereal (The Aligner)</h3>
                <p>
                    Because of this wobble, the sky has shifted by about 24 degrees since 2,000 years ago.
                </p>
                <ul>
                    <li><strong>Western (Tropical)</strong>: Ignores the wobble. It says "Aries starts on the first day
                        of Spring," even if the stars aren't there anymore.</li>
                    <li><strong>Hindu (Sidereal)</strong>: Accounts for the wobble. It tracks the <span
                            class="reactive-term" onclick="triggerVisualHighlight('ZODIAC_COMPARISON')">Ayanamsha<span
                                class="tooltip-bubble">The angular drift (24¬∞) between seasons and stars. <br><i>(Click
                                    to see 3D visual)</i></span></span> to tell you where the planets *actually* are.
                    </li>
                </ul>

                <div class="visual-block-wrapper" id="ZODIAC_COMPARISON">
                    <div class="visual-block">
                        <iframe class="visual-iframe" src="/visuals/zodiac-comparison"></iframe>
                        <div class="visual-caption">üñ•Ô∏è The "Great Drift" Aligner</div>
                    </div>
                    <div class="visual-significance">
                        <strong>Significance:</strong> Use the slider to see the 24-degree gap. This is why your "Star
                        Sign" in local newspapers is usually one sign off from your real astronomical position in the
                        sky.
                    </div>
                </div>

                <h2>5. The Shadow Planets (Rahu & Ketu)</h2>
                <p>
                    In ancient stories, Rahu and Ketu were demons who swallowed the Sun. Scientifically, they are
                    something even more fascinating: **The Lunar Nodes**.
                </p>
                <p>
                    Imagine the Earth's orbit as a flat yellow disc. The Moon's orbit is another disc, but it's tilted
                    by 5 degrees. These two discs cut through each other at exactly two points in space. These
                    mathematical intersection points are the <span class="reactive-term"
                        onclick="triggerVisualHighlight('LUNAR_NODES')">Lunar Nodes<span
                            class="tooltip-bubble">Mathematical intersection points where the Moon's tilted orbit
                            crosses the Earth's path. <br><i>(Click to see 3D visual)</i></span></span>.
                </p>

                <div class="visual-block-wrapper" id="LUNAR_NODES">
                    <div class="visual-block">
                        <iframe class="visual-iframe" src="/visuals/lunar-nodes"></iframe>
                        <div class="visual-caption">üñ•Ô∏è Rahu & Ketu: Intersecting Orbital Planes</div>
                    </div>
                    <div class="visual-significance">
                        <strong>Significance:</strong> **RAHU** (North Node) is where the Moon crosses UP through the
                        Earth's path. **KETU** (South Node) is where it crosses DOWN. These are the ONLY places where
                        eclipses can occur. They are "Shadow Planets" because they have weight in math and physics, but
                        no physical body.
                    </div>
                </div>

                <h2>6. The Celestial Race</h2>
                <p>
                    Why do we call Saturn "slow" and the Moon "fast"? It's all about the size of their track.
                </p>
                <ul>
                    <li><strong>The Moon</strong>: Running on the inner lane. It finishes a lap of the Zodiac every **27
                        days**.</li>
                    <li><strong>Jupiter</strong>: A massive middle track. It takes **12 years** to finish one lap.</li>
                    <li><strong>Saturn (Shani)</strong>: The outermost lane. It takes nearly **30 years** to finish the
                        same circle!</li>
                </ul>
                <p>
                    When you look at the "Cosmic Alignment" map on your results page, you are seeing these runners at
                    one frozen moment in their multi-year race.
                </p>

                <h2>7. The Sun's "Swing"</h2>
                <p>
                    Have you noticed the Sun is high in the sky in Summer and low in Winter? From Earth's perspective,
                    the Sun appears to "swing" North and South over the year.
                </p>
                <ul>
                    <li><strong>Uttarayana</strong>: The 6-month period when the Sun is moving Northward.</li>
                    <li><strong>Dakshinayana</strong>: The 6-month period when the Sun is moving Southward.</li>
                </ul>
                <p>
                    This is caused entirely by Earth's 23.5-degree slant relative to its orbit. It's why we have
                    seasons!
                </p>

                <h2>8. Two Ways to Measure a Month</h2>
                <p>
                    In the Hindu system, a "Month" (Masa) isn't just one thing. It's a relationship between the Sun and
                    the Moon.
                </p>

                <h3>The Cosmic Race Analogy</h3>
                <p>Imagine the Sun and Moon are runners on a track (the Zodiac).</p>
                <ol>
                    <li><strong>The Solar Runner (Saura Mana)</strong>: The Sun is steady. It spends about **30
                        days** in each sign. When it crosses the finish line into a new sign (e.g., Aries/Mesha), a
                        new Solar Month begins.</li>
                    <li><strong>The Lunar Sprinter (Chandra Mana)</strong>: The Moon is fast! It laps the zodiac in just
                        **27 days** but takes **29.5 days** to go from New Moon to New Moon.</li>
                </ol>

                <h3>The Naming Secret</h3>
                <p>
                    <strong>Solar Names</strong>: Named after the Sign the Sun enters (e.g., Mesha Masa).<br>
                    <strong>Lunar Names</strong>: Named after the Star (Nakshatra) the Moon is near when it is
                    <strong>FULL</strong> (e.g., Full Moon near Chitta = Chaitra).
                </p>

                <h3>The Pit Stop (Adhik Masa)</h3>
                <p>Because the Lunar Sprinter is faster, it finishes its year in ~354 days (11 days early!). To keep the
                    runners together, the Lunar calendar takes a **"Pit Stop"** (Adhik Masa / Extra Month) every ~3
                    years to let the Sun catch up.</p>

                <h2>9. The Official Calendar vs. The Sky Calendar</h2>
                <p>
                    The <strong>"Saka Varsha"</strong> (Saka Era) shown on the dashboard is the <strong>Official Civil
                        Calendar</strong> of India.
                    It is different from the <strong>Samvatsara</strong> (Sky Calendar) used for festivals.
                </p>
                <h3>The Two Clocks:</h3>
                <ol>
                    <li><strong>Civil Time (Saka Era)</strong>:
                        <ul>
                            <li><strong>Purpose</strong>: Administration (Taxes, Banking, Government Gazettes).</li>
                            <li><strong>Type</strong>: Purely <strong>Solar</strong>. It ignores the Moon phases.</li>
                            <li><strong>Origin</strong>: Started in <strong>78 AD</strong> (King Shalivahana's Era).
                            </li>
                            <li><strong>Math</strong>: It is exactly 78 years behind the Western Calendar.</li>
                        </ul>
                    </li>
                    <li><strong>Cosmic Time (Samvatsara)</strong>:
                        <ul>
                            <li><strong>Purpose</strong>: Agriculture and Nature (Tides, Seasons, Harvests).</li>
                            <li><strong>Type</strong>: <strong>Luni-Solar</strong>. It weaves the Sun and Moon together.
                            </li>
                            <li><strong>Origin</strong>: The 60-year resonance of Jupiter and Saturn.</li>
                        </ul>
                    </li>
                </ol>
                <p><i>Think of Saka as the "Office Clock" and Samvatsara as the "Nature Clock."</i></p>

                <blockquote
                    style="background: rgba(255, 145, 0, 0.08); border-left: 4px solid var(--secondary); padding: 1.5rem; margin: 2rem 0; border-radius: 0 16px 16px 0;">
                    <h4 style="color: var(--secondary); margin-top: 0; font-size: 1.2rem;">‚öîÔ∏è The Legend of 78 AD</h4>
                    <p style="margin-bottom: 0;">
                        In <strong>78 AD</strong>, the legendary Indian Emperor <strong>Shalivahana</strong> achieved a
                        decisive military victory over the invading <strong>Saka kings</strong> (Scythians from Central
                        Asia). To commemorate this triumph of indigenous rule and mark a new chapter in Indian
                        sovereignty, he established a new Era‚Äîthe <strong>Shalivahana Saka</strong>.
                    </p>
                    <p style="margin-bottom: 0; margin-top: 1rem;">
                        Centuries later, when the Government of India adopted an official civil calendar in
                        <strong>1957</strong>, they chose this specific timeline to honor India's rich history and
                        cultural continuity. Today, the Saka Era appears on all official documents, from currency notes
                        to government gazettes.
                    </p>
                </blockquote>

                <h2>10. Live Scientific Support: Chat with the Maestro</h2>
                <p>
                    Need help navigating the simulation? Or want to know more about a specific star?
                </p>
                <ul>
                    <li><strong>Floating Chat Widget</strong>: Look for the ‚ú® icon in the bottom-right corner.</li>
                    <li><strong>Expert Guidance</strong>: The <strong>Maestro</strong> is an AI science educator
                        integrated
                        directly into the app. You can ask him functional questions like <i>"Where do I find the Moons
                            phases?"</i> or deep scientific questions like <i>"Why is Rahu called a ghost planet?"</i>
                    </li>
                    <li><strong>App Support</strong>: If you get stuck or a simulation isn't loading, the Maestro can
                        guide you through the interface.</li>
                </ul>

                <h2>üéì The Maestro's Challenge</h2>
                <p>
                    At the bottom of your Insights report, look for the <strong>Maestro's Challenge</strong>. It's a
                    real-time assessment to see if you've mastered the archaeoastronomy of the current day!
                </p>

                <div
                    style="text-align: center; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--glass-border);">
                    <p style="font-size: 1.3rem; margin-bottom: 2.5rem;">Ready to see your own cosmic signature?</p>
                    <a href="/" class="btn"
                        style="padding: 1.2rem 3rem; border-radius: 50px; background: var(--secondary); color: #000; font-weight: 700; text-decoration: none; font-size: 1.1rem; box-shadow: 0 10px 20px rgba(255, 145, 0, 0.2);">Run
                        New Conversion</a>
                </div>
            </section>
        </main>

        <footer style="padding: 4rem 0;">
            <p>&copy; 2026 Hindu Panchanga Engine | Student Masterclass Initiative</p>
            <p style="margin-top: 1rem; opacity: 0.5;">Scientific calculations powered by NASA JPL Ephemerides.</p>
        </footer>
    </div>

    <!-- Cosmic Chatbot Widget -->
    <div id="chat-widget-container">
        <div id="chat-window">
            <div class="chat-header">
                <h4>‚ú® Chat with the Maestro</h4>
                <button onclick="toggleChat()"
                    style="background:none; border:none; color:white; cursor:pointer; font-size:1.2rem;">√ó</button>
            </div>
            <div id="chat-messages" class="chat-messages">
                <div class="message bot">
                    Greetings, cosmic traveler! I am the Maestro. Ask me anything about the stars, the Panchanga,
                    or how ancient civilizations read the sky.
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Ask about the stars..."
                    onkeypress="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()"
                    style="background:var(--secondary); border:none; border-radius:8px; padding:0 10px; cursor:pointer;">‚ûî</button>
            </div>
        </div>
        <button id="chat-toggle-btn" onclick="toggleChat()">‚ú®</button>
    </div>

    <script>
        // Reactive Highlights
        function triggerVisualHighlight(tagId) {
            const el = document.getElementById(tagId);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                el.classList.add('highlight-flash');
                setTimeout(() => el.classList.remove('highlight-flash'), 2500);

                // Signal the iframe to pulse if it supports it
                const iframe = el.querySelector('iframe');
                if (iframe) {
                    iframe.contentWindow.postMessage({ action: 'pulse' }, '*');
                }
            }
        }

        // Audio Narration Logic (v5.4 Summary Refined)
        const audioBtn = document.getElementById('audio-tutor-btn');
        let utterance = null;

        audioBtn.onclick = () => {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                updateAudioUI(false);
                return;
            }

            // High-level overview instead of reading everything
            const summaryText = "Welcome to the Cosmic Masterclass. In this guide, we bridge two worlds: the Western solar calendar (seasons) and the Hindu Panchanga (fixed stars). We explore the five limbs of time, the 24-degree drift of Earth's wobble, and the mathematical intersection of the lunar nodes known as Rahu and Ketu. Use the 3D modules and the interactive glossary to see how the ancients turned the sky into a high-precision GPS. I am here to guide you through the geometry of the heavens.";

            utterance = new SpeechSynthesisUtterance(summaryText);

            // Premium voice settings
            utterance.pitch = 1.0;
            utterance.rate = 0.95;

            utterance.onstart = () => updateAudioUI(true);
            utterance.onend = () => updateAudioUI(false);
            utterance.onerror = () => updateAudioUI(false);

            window.speechSynthesis.speak(utterance);
        };

        function updateAudioUI(isPlaying) {
            const icon = document.getElementById('audio-icon');
            const text = document.getElementById('audio-text');
            if (isPlaying) {
                icon.innerText = "üõë";
                text.innerText = "Stop Masterclass";
                audioBtn.style.background = "rgba(231, 76, 60, 0.2)";
                audioBtn.style.borderColor = "#e74c3c";
            } else {
                icon.innerText = "üéôÔ∏è";
                text.innerText = "Listen to Maestro";
                audioBtn.style.background = "rgba(0, 210, 255, 0.1)";
                audioBtn.style.borderColor = "var(--secondary)";
            }
        }

        // Chatbot Functionality (v5.4)
        function toggleChat() {
            const window = document.getElementById('chat-window');
            window.classList.toggle('active');
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const messages = document.getElementById('chat-messages');
            const text = input.value.trim();
            if (!text) return;

            // 1. Append User Message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.textContent = text;
            messages.appendChild(userMsg);
            input.value = '';
            messages.scrollTop = messages.scrollHeight;

            // 2. Append Loading Dots
            const botMsg = document.createElement('div');
            botMsg.className = 'message bot';
            botMsg.innerHTML = 'Consulting the Sages<span class="dots"></span>';
            messages.appendChild(botMsg);
            messages.scrollTop = messages.scrollHeight;

            try {
                // For guide.html, we use a general cosmic context
                const context = {
                    address: "Cosmic Explorer Academy",
                    samvatsara: "Universal Cycle",
                    tithi: "Lunar Geometry",
                    nakshatra: "Fixed Stars"
                };

                const response = await fetch('/api/ai-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, context })
                });

                const result = await response.json();
                botMsg.textContent = result.success ? result.response : "The star-link is fuzzy... " + result.error;
            } catch (err) {
                botMsg.textContent = "The Maestro is currently observing the stars and cannot be reached.";
            }
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>

</html>